上节提到，走样的本质原因是信号的变化速度太快，采样的速度跟不上。  

变化速度与采样速度，都是与频率相关的概念，因此本节从频域的角度来分析走样问题。   


# 频域的相关概念

## 余弦波

\\(\cos 2\pi fx\\)，其中f代表频率。f越大，则信号变化越快。   

<div align="center"> <img src="../assets/余弦函数.jpg" width = 485 /> </div>

## 傅里叶级数展开：

任何一个周期函数可以写成：不同频率的正/余弦函数的线性组合，以及一个常数。

![](../assets/傅里叶展开.jpg)

> &#x2753; 非周期函数会怎么样呢？

## 傅里叶变换（可逆）

<div align="center"> <img title="" src="../assets/傅里叶变换.jpg" width="589" /></div>

傅里叶变换是指把函数转为它在频域上级数展开的形式。   

# 函数与采样的关系

## 函数的频率

基于傅里叶变换，可以把函数分解为不同的频率的函数[24：51]  
频率高，即代表信号变化快。也就是说，一个函数是由各种不同频率的信号混合而成的。   

## 采样的频率

[24:51]

以相同采样频率对以上函数采样

通过采样点能恢复出低频信息，不能恢复出高频信息。

[29:00]

走样的本质原因的数学描述：两个不同频率（蓝黑）的信号，在某采样频率下，得到了完全相同的采样点，因此无法区分。

![](../assets/采样两个函数.jpg)

因此**函数中的低频部分的信号就被当成了另一种信号**。



# 图像中的频率成分[29：32]

即：把某些信息（即特定的频率分量）去掉。以图像为例，把图像（时域信息）转成频域信息[31：01]：

   <img src="../assets/低频高频.jpg" title="" alt="" width="337">

图像的频域图具有以下特点：

- 图中点越亮代表此处频率的能量越高
- 图像中的信息大部分为低频信息
- 由于强行把图像周期化，红色框中的亮线是图像跨越边界时产生的高频信息

   <img src="../assets/频率图.jpg" title="" alt="" width="337">

## 高通 filter [34：21]

保留频域图中的高频信息，再把频域图恢复成原始图像。发现图像只剩下了原图的轮廓部分。  

<img title="" src="../assets/高通.jpg" alt="" width="476">

解释：

保留的高频信息对应于图像边界。因为图像边缘为信号的剧变处。

## 低通 filter [36：19]

同理，只保留图像的低频信息，图像会变模糊，失去边界

   <img title="" src="../assets/低通.jpg" alt="" width="476">

# 频域与时域的关系

## 滤波 VS 卷积 VS 平均

### 卷积 VS 平均

结论1： **卷积可以看作是个局部区域的加权平均， 卷积kernel即局部加权**  

### 卷积 VS 滤波

图像的卷积操作是从信号的卷积运算中借鉴过来的概念。虽然不完全相同，其本质是一样的。  
图像的卷积操作可以看作中对图像的时域信息做卷积运算，时域信息的卷积运算又可以转化为频域上的乘积运算。前面所讲的滤波操作实际上就是用频域上的乘积运算来实现的。因此图像的时域卷积操作与频域滤波操作本质上是一致的。

结论2：**时域卷积 = 频域滤波， 卷积kernel = 频域filter**

### 结论：

时域卷积 = 频域滤波 = 局部加权平均

卷积kernel = 频域filter = 局部加权

以低通滤波为例：

<img title="" src="../assets/时域卷积.jpg" alt="" width="507">  

## 采样 VS 频域卷积

### 例子

<img title="" src="../assets/时域采样和频域采样.jpg" alt="" width="536">  

解释：  

a：时域信号   

b：a对应的频域信号   

c：对a进行采样的周期采样函数  

d：采样函数的频域表示  

e：对a进行采样的结果，即a与c乘积的结果  

f：采样结果的频域表示。由于时域乘积=频域卷积，这也中b与d卷积的结果

### 分析

采样是通过时域上的乘积操作实现的。

时域乘积 = 频域卷积

\\[
f_1\left( x \right) \times f_2\left( x \right) \Longleftrightarrow F_1\left( \omega \right) \otimes F_2\left( \omega \right) 
\\]

> &#x1F4A1; \\(f_1\left( x \right)\\) 是信号（a）， \\(f_2\left( x \right)\\)是采样信号（c）， \\(F_1\left( \omega \right)\\) 是a的频谱（b）  \\(F_2\left( \omega \right)\\) 是采样信号的频谱（d）0

采样就是把原信号的频谱以特定周期呈现。

采样周期长 \\(\Longrightarrow \\)

\\(\Longrightarrow \\) \\(F_2\left( \omega \right)\\) 的频谱间隔小

\\(\Longrightarrow \\) (b)以更密的形式重复

\\(\Longrightarrow \\) (f)的频谱出现混叠

\\(\Longrightarrow \\) 时域上表现为走样

<img title="" src="../assets/周期混叠.jpg" alt="" width="600">

## 怎样反走样？

### 提升分辨率

分辨率上升 \\(\Longrightarrow \\) 像素格子小 \\(\Longrightarrow \\) 像素采样率上升 \\(\Longrightarrow \\) （b）间隔大 \\(\Longrightarrow \\) 混叠少 \\(\Longrightarrow \\) 减轻走样现象

缺点：受制于物理限制

### 反走样算法

1. 信号转频域
2. 低通filter，过滤高频信息，使（b）变窄
3. 采样
   
   <img title="" src="../assets/采样.jpg" alt="" width="600">


###  其他反走样算法

[1：05：17]

#### MSAA

1. 一个象素内部划分成多个子（sub）像素
2. 判断每个点是否在三角形内
3. 把判断的结果平均

![](../assets/MSAA.jpg)


> **&#x2757;注意:** Supersampling 与提升分辨率的区别：
> 本算法并没有实质性地增加像素点
>
> 缺点：增加计算量


#### FXAA

1. 用常规方法得到带锯齿图像
2. 通过图像匹配的方法找到边界
3. 把边界换成没有锯齿的边界

优点：速度快， 与采样无关

#### TAA 

[1：15：10]

**T** ：Temporal .时间上的

大概意思是,边界上的点，有时显示在上一帧，有时显示在这一帧

### 其它问题

#### Super Resolution 超分辨率

- 低分辨率图拉大成高分辨率出现的锯齿问题
- 解决方法，一 DLSS
- Deep Learning Super Sampling

#### Super Sampling 上采样

跟上面是同一个问题。







----------------------------
> 本文出自CaterpillarStudyGroup，转载请注明出处。
>
> https://caterpillarstudygroup.github.io/GAMES101_mdbook/
